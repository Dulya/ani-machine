/**
 * ani-machine - Declarative animation and machine state
 * @version v0.1.3
 * @link https://github.com/jfroffice/ani-machine
 * @license MIT
 */
var prefix=function(){"use strict";function e(e){var t=document.body||document.documentElement,n=t.style,r=["Moz","Webkit","Khtml","O","ms"],i=e;if("string"==typeof n[i])return e;i=i.charAt(0).toUpperCase()+i.substr(1);for(var o=0;o<r.length;o++)if("string"==typeof n[r[o]+i])return r[o]+i;return!1}var t={WebkitAnimation:"webkitAnimationEnd",OAnimation:"oAnimationEnd",msAnimation:"MSAnimationEnd",animation:"animationend"},n={WebkitTransition:"webkitTransitionEnd",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"};return{TRANSITION_END_EVENT:n[e("transition")],ANIMATION_END_EVENT:t[e("animation")]}}(),tt=function(){"use strict";return{parseOn:function(e){return"enter"===e?e="mouseenter":"leave"===e&&(e="mouseleave"),e}}}(),am=am||{};am.viewport=function(){"use strict";function e(e){var t=0,n=0;do isNaN(e.offsetTop)||(t+=e.offsetTop),isNaN(e.offsetLeft)||(n+=e.offsetLeft);while(e=e.offsetParent);return{top:t,left:n}}function t(){var e=window.document.documentElement.clientHeight,t=window.innerHeight;return t>e?t:e}return{isInside:function(n,r){var i=window.pageYOffset,o=i+t(),a=n.offsetHeight,s=e(n).top,u=s+a;return r=r||.5,o>=s+a*r&&u>=i||"fixed"==(n.currentStyle?n.currentStyle:window.getComputedStyle(n,null)).position}}}();var styles=function(){"use strict";function e(e,t){return n[e]?void 0:(n[e]=!0,"."+e+"{"+t+"}")}function t(t,n){var r=e(t,n);if(!r)return t;var i=document.createElement("style");return i.type="text/css",i.innerHTML=r,document.getElementsByTagName("head")[0].appendChild(i),t}var n={};return{add:t}}(),translate=function(){"use strict";function e(e){var t,n="translate",r=n+e.axis+"("+e.move+"); ",i="-webkit-transform: "+r+"transform: "+r,o=e.opacity?"1":"0";i+="opacity: "+o+";";var t=(n+"_"+e.axis+"_"+e.move+"_"+e.opacity).replace(/-/g,"m");return console.log(i),styles.add(t,i)}return{genCSS:e}}(),transition=function(){"use strict";function e(e,t,n){var r=e+" "+t+" "+n,i=r+", opacity "+r+";",o="_"+r.replace(/ /g,"_").replace(/\./g,"_"),a="-webkit-transition: -webkit-transform "+i+"transition: transform "+i;return console.log(a),styles.add(o,a)}return{genCSS:e}}(),enter=function(){"use strict";function e(e){var t,n=e.split(/[, ]+/),r={};return n.forEach(function(e,i){switch(t=n[i+1],e){case"enter":return void(r.enter=t);case"after":case"wait":return void(r.after=t);case"move":return void(r.move=t);case"over":return void(r.over=t);case"scale":return r.scale={},"up"==t||"down"==t?(r.scale.direction=t,void(r.scale.power=n[i+2])):void(r.scale.power=t);default:return}}),r}function t(t){var n=e("enter "+t),r=n.over||"0.7s",i=n.enter||"left",o="left"!==i&&"top"!==i?n.move:"-"+n.move,a=n.after||"0s",s=n.easing||"ease-in-out",u=n.scale,c="x";if(!i||"top"!==i&&"bottom"!==i||(c="y"),u&&0!=parseInt(u.power)){var f=.01*parseFloat(u.power);"up"==u.direction&&(f=-f),u.value=1+f}return console.log(n),console.log(u),{initial:translate.genCSS({axis:c,move:o,opacity:!1}),transition:transition.genCSS(r,s,a)}}return{genCSS:t}}();am.frame=function(){var e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)};return function(t){e.call(window,t)}}(),am.build=function(){"use strict";function e(e){getComputedStyle(e[0],null).display}function t(t,n,r,i,o){e(t),r&&t.addClass(r),t.addClass(i),n&&t.removeClass(n),t.one(prefix.TRANSITION_END_EVENT,function(){t.removeClass(i),o&&o()})}return function(n,r,i){var o;return"enter"===r?function(e){o=enter.genCSS(i),n.addClass(o.initial),t(n,o.initial,null,o.transition,function(){e&&e()})}:function(t){e(n);var r=i+" animated";n.addClass(r).one(prefix.ANIMATION_END_EVENT,function(){n.removeClass(r),t&&t()})}}}(),am.maestro={init:function(e){function t(e,t){var r=t.split(" "),i=r[0],o=tt.parseOn(r[1]);[].forEach.call(document.querySelectorAll(i),function(t){t.addEventListener(o,function(){n.changeState(e)})})}var n=this,r=e.triggers;n.events=e.events,n.element=e.element,n.deferFn=e.timeoutFn,n.jobs=[],n.unregisters=[],n.currentState,n.running;for(var i in r){var o=r[i];o&&t(i,o)}},changeState:function(e){function t(e){a.jobs.push(e),n()}function n(){if(!a.running){var e=a.jobs[0];e&&(a.running=!0,e.run(function(){e.finish(),a.jobs.splice(0,1),a.running=!1,n()}))}}function r(e){if(e){var t=[];return e.forEach(function(e){t.push(o(e))}),t}}function i(e){e=window[e],"function"==typeof e&&e.apply(null,a)}function o(e){function n(){if(f&&i(f),!e.param)return void r();var n=e.param.split(" ");n&&":enter"===n[0]?t({run:am.build(a.element,"enter",n.slice(1,n.length)),finish:o}):(e.currentStep+=1,e.currentStep>=n.length?console.warn("try to relaunch animation that is not finished"):t({run:am.build(a.element,e.type,n[e.currentStep]),finish:u}))}function r(){c&&(m!==s&&a.element.off(m,n),a.changeState(c))}function o(){r(),l&&i(l)}function u(){e.currentStep<e.param.split(" ").length-1?am.frame(n):e.currentStep=-1,o()}var c=e.goto,f=e.before?e.before.replace("()",""):"",l=e.after?e.after.replace("()",""):"",m=e.on;return m===s?am.frame(n):a.element.on(m,n),function(){a.element.off(m,n)}}var a=this,s="active",u=a.currentState===e;if(a.currentState&&a.unregisters&&!u)for(var c=0;c<a.unregisters.length;c++)a.unregisters[c]();u?r(a.events[e]):(a.currentState=e,a.unregisters=r(a.events[e]))}},angular.module("aniMachine",[]).directive("amElement",["$timeout","$window",function(e,t){return{restrict:"A",scope:{enter:"@"},link:function(n,r){var i=n.events,o=n.triggers,a=Object.create(am.maestro);a.init({triggers:o,events:i,element:r,timeoutFn:e}),(i.enter||i.leave)&&(am.viewport.isInside(r[0])&&(i["default"]||a.changeState("enter")),n.$watch(function(){return am.viewport.isInside(r[0])},function(e,t){e!==t&&a.changeState(e?"enter":"leave")},!0),angular.element(t).bind("resize",function(){n.$apply()}).bind("scroll",function(){n.$apply()})),a.changeState("default")},controller:["$scope","$element",function(e){e.events={},e.triggers={},this.setEvents=function(t,n,r){t=t||"default",e.events[t]=r,e.triggers[t]=n}}]}}]).directive("amState",function(){return{restrict:"E",scope:{value:"@",trigger:"@"},require:"^amElement",link:function(e,t,n,r){r.setEvents(e.value,e.trigger,e.events)},controller:["$scope",function(e){e.events=[],this.addEvent=function(t){e.events.push(t)}}]}}).directive("amEvent",function(){return{restrict:"E",scope:{on:"@",before:"@",after:"@",animate:"@","goto":"@"},require:"^amState",link:function(e,t,n,r){var i,o,a=tt.parseOn(e.on);e.animate&&(i="animate",o=e.animate),r.addEvent({on:a,type:i,param:o,currentStep:-1,before:e.before,after:e.after,"goto":e.goto})}}});