/**
 * ani-machine - Declarative animation and machine state
 * @version v0.1.3
 * @link https://github.com/jfroffice/ani-machine
 * @license MIT
 */
var prefix=function(){"use strict";function t(t){var e=document.body||document.documentElement,n=e.style,r=["Moz","Webkit","Khtml","O","ms"],i=t;if("string"==typeof n[i])return t;i=i.charAt(0).toUpperCase()+i.substr(1);for(var a=0;a<r.length;a++)if("string"==typeof n[r[a]+i])return r[a]+i;return!1}var e={WebkitAnimation:"webkitAnimationEnd",OAnimation:"oAnimationEnd",msAnimation:"MSAnimationEnd",animation:"animationend"},n={WebkitTransition:"webkitTransitionEnd",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"};return{TRANSITION_END_EVENT:n[t("transition")],ANIMATION_END_EVENT:e[t("animation")]}}(),tt=function(){"use strict";return{parseOn:function(t){return"enter"===t?t="mouseenter":"leave"===t&&(t="mouseleave"),t}}}(),am=am||{};am.viewport=function(){"use strict";function t(t){var e=0,n=0;do isNaN(t.offsetTop)||(e+=t.offsetTop),isNaN(t.offsetLeft)||(n+=t.offsetLeft);while(t=t.offsetParent);return{top:e,left:n}}function e(){var t=window.document.documentElement.clientHeight,e=window.innerHeight;return e>t?e:t}return{isInside:function(n,r){var i=window.pageYOffset,a=i+e(),o=n.offsetHeight,s=t(n).top,u=s+o;return r=r||.5,a>=s+o*r&&u>=i||"fixed"==(n.currentStyle?n.currentStyle:window.getComputedStyle(n,null)).position}}}();var styles=function(){"use strict";function t(t,e){return n[t]?void 0:(n[t]=!0,"."+t+"{"+e+"}")}function e(e,n){var r=t(e,n);if(!r)return e;var i=document.createElement("style");return i.type="text/css",i.innerHTML=r,document.getElementsByTagName("head")[0].appendChild(i),e}var n={};return{add:e}}(),translate=function(){"use strict";function t(t,e,n){var r="translate",i=r+t+"("+e+"); ",a="-webkit-transform: "+i+"transform: "+i;void 0!==n&&(a+="opacity: "+(n?"1":"0")+";");var o=(r+"_"+t+"_"+e+"_"+n).replace(/-/g,"m");return styles.add(o,a)}return{genCSS:t}}(),transition=function(){"use strict";function t(t,e,n){var r=t+" "+e+" "+n,i=r+", opacity "+r+";",a="_"+r.replace(/ /g,"_").replace(/\./g,"_");return styles.add(a,"-webkit-transition: -webkit-transform "+i+"transition: transform "+i)}return{genCSS:t}}(),enter=function(){"use strict";function t(t){var e,n=t.split(/[, ]+/),r={};return n.forEach(function(t,i){switch(e=n[i+1],t){case"enter":return void(r.enter=e);case"after":case"wait":return void(r.after=e);case"move":return void(r.move=e);case"over":return void(r.over=e);default:return}}),r}function e(e){var n=t("enter "+e),r=n.over||"0.7s",i=n.enter||"left",a="left"!==i&&"top"!==i?n.move:"-"+n.move,o=n.after||"0s",s=n.easing||"ease-in-out",u="x";return!i||"top"!==i&&"bottom"!==i||(u="y"),{initial:translate.genCSS(u,a,!1),transition:transition.genCSS(r,s,o)}}return{genCSS:e}}(),animator=function(){"use strict";function t(t){getComputedStyle(t[0],null).display}function e(e,n,r,i,a){t(e),r&&e.addClass(r),e.addClass(i),n&&e.removeClass(n),e.one(prefix.TRANSITION_END_EVENT,function(){e.removeClass(i),a&&a()})}return{build:function(n,r,i){var a;return"enter"===r?function(t){a=enter.genCSS(i),n.addClass(a.initial),e(n,a.initial,null,a.transition,function(){t&&t()})}:function(e){t(n);var r=i+" animated";n.addClass(r).one(prefix.ANIMATION_END_EVENT,function(){n.removeClass(r),e&&e()})}}}}(),am=am||{};am.maestro={init:function(t){function e(t,e){var r=e.split(" "),i=r[0],a=tt.parseOn(r[1]);[].forEach.call(document.querySelectorAll(i),function(e){e.addEventListener(a,function(){n.changeState(t)})})}var n=this,r=t.triggers;n.events=t.events,n.element=t.element,n.deferFn=t.timeoutFn,n.jobs=[],n.unregisters=[],n.currentState,n.running;for(var i in r){var a=r[i];a&&e(i,a)}},changeState:function(t){function e(t){o.jobs.push(t),n()}function n(){if(!o.running){var t=o.jobs[0];t&&(o.running=!0,t.run(function(){t.finish(),o.jobs.splice(0,1),o.running=!1,n()}))}}function r(t){if(t){var e=[];return t.forEach(function(t){e.push(a(t))}),e}}function i(t){t=window[t],"function"==typeof t&&t.apply(null,o)}function a(t){function n(){if(f&&i(f),!t.param)return void r();var n=t.param.split(" ");n&&":enter"===n[0]?e({run:animator.build(o.element,"enter",n.slice(1,n.length)),finish:a}):(t.currentStep+=1,t.currentStep>=n.length?console.warn("try to relaunch animation that is not finished"):e({run:animator.build(o.element,t.type,n[t.currentStep]),finish:u}))}function r(){c&&(m!==s&&o.element.off(m,n),o.changeState(c))}function a(){r(),l&&i(l)}function u(){t.currentStep<t.param.split(" ").length-1?o.deferFn(n,0):t.currentStep=-1,a()}var c=t.goto,f=t.before?t.before.replace("()",""):"",l=t.after?t.after.replace("()",""):"",m=t.on;return m===s?o.deferFn(n,0):o.element.on(m,n),function(){o.element.off(m,n)}}var o=this,s="active",u=o.currentState===t;if(o.currentState&&o.unregisters&&!u)for(var c=0;c<o.unregisters.length;c++)o.unregisters[c]();u?r(o.events[t]):(o.currentState=t,o.unregisters=r(o.events[t]))}},angular.module("aniMachine",[]).directive("amElement",["$timeout","$window",function(t,e){return{restrict:"A",scope:{enter:"@"},link:function(n,r){var i=n.events,a=n.triggers,o=Object.create(am.maestro);o.init({triggers:a,events:i,element:r,timeoutFn:t}),(i.enter||i.leave)&&(am.viewport.isInside(r[0])&&(i["default"]||o.changeState("enter")),n.$watch(function(){return am.viewport.isInside(r[0])},function(t,e){t!==e&&o.changeState(t?"enter":"leave")},!0),angular.element(e).bind("resize",function(){n.$apply()}).bind("scroll",function(){n.$apply()})),o.changeState("default")},controller:["$scope","$element",function(t){t.events={},t.triggers={},this.setEvents=function(e,n,r){e=e||"default",t.events[e]=r,t.triggers[e]=n}}]}}]).directive("amState",function(){return{restrict:"E",scope:{value:"@",trigger:"@"},require:"^amElement",link:function(t,e,n,r){r.setEvents(t.value,t.trigger,t.events)},controller:["$scope",function(t){t.events=[],this.addEvent=function(e){t.events.push(e)}}]}}).directive("amEvent",function(){return{restrict:"E",scope:{on:"@",before:"@",after:"@",animate:"@","goto":"@"},require:"^amState",link:function(t,e,n,r){var i,a,o=tt.parseOn(t.on);t.animate&&(i="animate",a=t.animate),r.addEvent({on:o,type:i,param:a,currentStep:-1,before:t.before,after:t.after,"goto":t.goto})}}});