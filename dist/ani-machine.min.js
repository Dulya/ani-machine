/**
 * ani-machine - Declarative animation and machine state
 * @version v0.1.2
 * @link https://github.com/jfroffice/ani-machine
 * @license MIT
 */
var prefix=function(){"use strict";function t(t){var n=document.body||document.documentElement,e=n.style,r=["Moz","Webkit","Khtml","O","ms"],i=t;if("string"==typeof e[i])return t;i=i.charAt(0).toUpperCase()+i.substr(1);for(var o=0;o<r.length;o++)if("string"==typeof e[r[o]+i])return r[o]+i;return!1}var n={WebkitAnimation:"webkitAnimationEnd",OAnimation:"oAnimationEnd",msAnimation:"MSAnimationEnd",animation:"animationend"},e={WebkitTransition:"webkitTransitionEnd",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"};return{TRANSITION_END_EVENT:e[t("transition")],ANIMATION_END_EVENT:n[t("animation")]}}(),tt=function(){"use strict";return{parseOn:function(t){return"enter"===t?t="mouseenter":"leave"===t&&(t="mouseleave"),t}}}(),am=am||{};am.viewport=function(){"use strict";function t(t){var n=0,e=0;do isNaN(t.offsetTop)||(n+=t.offsetTop),isNaN(t.offsetLeft)||(e+=t.offsetLeft);while(t=t.offsetParent);return{top:n,left:e}}function n(){var t=window.document.documentElement.clientHeight,n=window.innerHeight;return n>t?n:t}return{isInside:function(e,r){var i=window.pageYOffset,o=i+n(),a=e.offsetHeight,u=t(e).top,s=u+a,r=r||.5;return o>=u+a*r&&s>=i||"fixed"==(e.currentStyle?e.currentStyle:window.getComputedStyle(e,null)).position}}}();var styles=function(){"use strict";function t(t,n){return e[t]?void 0:(e[t]=!0,"."+t+"{"+n+"}")}function n(n,e){var r=t(n,e);if(!r)return n;var i=document.createElement("style");return i.type="text/css",i.innerHTML=r,document.getElementsByTagName("head")[0].appendChild(i),n}var e={};return{add:n}}(),translate=function(){"use strict";function t(t,n,e){var r="translate",i=r+t+"("+n+"); ",o="-webkit-transform: "+i+"transform: "+i;void 0!==e&&(o+="opacity: "+(e?"1":"0")+";");var a=(r+"_"+t+"_"+n+"_"+e).replace(/-/g,"m");return styles.add(a,o)}return{genCSS:t}}(),transition=function(){"use strict";function t(t,n,e){var r=t+" "+n+" "+e,i=r+", opacity "+r+";",o="_"+r.replace(/ /g,"_").replace(/\./g,"_");return styles.add(o,"-webkit-transition: -webkit-transform "+i+"transition: transform "+i)}return{genCSS:t}}(),enter=function(){"use strict";function t(t){var n,e=t.split(/[, ]+/),r={};return e.forEach(function(t,i){switch(n=e[i+1],t){case"enter":return void(r.enter=n);case"after":case"wait":return void(r.after=n);case"move":return void(r.move=n);case"over":return void(r.over=n);default:return}}),r}function n(n){var e=t("enter "+n),r=e.over||"0.7s",i=e.enter||"left",o="left"!==i&&"top"!==i?e.move:"-"+e.move,a=e.after||"0s",u=e.easing||"ease-in-out",s="x";return!i||"top"!==i&&"bottom"!==i||(s="y"),{initial:translate.genCSS(s,o,!1),transition:transition.genCSS(r,u,a)}}return{genCSS:n}}(),animator=function(){"use strict";function t(t){getComputedStyle(t[0],null).display}function n(n,e,r,i,o){t(n),r&&n.addClass(r),n.addClass(i),e&&n.removeClass(e),n.one(prefix.TRANSITION_END_EVENT,function(){n.removeClass(i),o&&o()})}return{build:function(e,r,i){var o;return"enter"===r?function(t){o=enter.genCSS(i),e.addClass(o.initial),n(e,o.initial,null,o.transition,function(){t&&t()})}:function(n){t(e);var r=i+" animated";e.addClass(r).one(prefix.ANIMATION_END_EVENT,function(){e.removeClass(r),n&&n()})}}}}();angular.module("aniMachine",[]).directive("amElement",["$timeout","$window",function(t,n){var e="active";return{restrict:"A",scope:{enter:"@"},link:function(r,i,o){function a(t){var n=p===t;if(p&&m&&!n)for(var e=0;e<m.length;e++)m[e]();n?c(g[t]):(p=t,m=c(g[t]))}function u(){for(var t in E){var n=E[t];n&&s(t,n)}}function s(t,n){var e=n.split(" "),r=e[0],i=tt.parseOn(e[1]);[].forEach.call(document.querySelectorAll(r),function(n){n.addEventListener(i,function(){a(t)})})}function c(t){if(t){var n=[];return t.forEach(function(t){n.push(d(t))}),n}}function f(t){h.push(t),l()}function l(){if(!v){var t=h[0];t&&(v=!0,t.run(function(){t.finish(),h.splice(0,1),v=!1,l()}))}}function d(n){function r(){n.currentStep<n.param.split(" ").length-1?t(s,0):n.currentStep=-1,o&&(u!==e&&i.off(u,s),a(o))}var o=n.goto,u=n.on,s=function(){var t=n.param.split(" ");n.currentStep+=1,n.currentStep>=t.length?console.warn("try to relaunch animation that is not finished"):f({run:animator.build(i,n.type,t[n.currentStep]),finish:r})};return u===e?t(s,0):i.on(u,s),function(){i.off(u,s)}}var v,m,p,g=r.events,E=r.triggers,h=[];return u(),(g.enter||g.leave)&&(am.viewport.isInside(i[0])&&(g["default"]||a("enter")),r.$watch(function(){return am.viewport.isInside(i[0])},function(t,n){t!==n&&a(t?"enter":"leave")},!0),angular.element(n).bind("resize",function(){r.$apply()}).bind("scroll",function(){r.$apply()})),o.enter?void f({run:animator.build(i,"enter",o.enter),finish:function(){a("default")}}):void a("default")},controller:["$scope","$element",function(t){t.events={},t.triggers={},this.setEvents=function(n,e,r){n=n||"default",t.events[n]=r,t.triggers[n]=e}}]}}]).directive("amState",function(){return{restrict:"E",scope:{value:"@",trigger:"@"},require:"^amElement",link:function(t,n,e,r){r.setEvents(t.value,t.trigger,t.events)},controller:["$scope",function(t){t.events=[],this.addEvent=function(n){t.events.push(n)}}]}}).directive("amEvent",function(){return{restrict:"E",scope:{on:"@",animate:"@",enter:"@","goto":"@"},require:"^amState",link:function(t,n,e,r){var i,o,a=tt.parseOn(t.on);t.enter?(i="enter",o=t.enter):t.animate&&(i="animate",o=t.animate),r.addEvent({on:a,type:i,param:o,currentStep:-1,"goto":t.goto})}}});