/**
 * ani-machine - Declarative animation and machine state
 * @version v0.1.6
 * @link https://github.com/jfroffice/ani-machine
 * @license MIT
 */
var am={};am.prefix=function(){"use strict";function e(e){var t=document.body||document.documentElement,n=t.style,r=["Moz","Webkit","Khtml","O","ms"],a=e;if("string"==typeof n[a])return e;a=a.charAt(0).toUpperCase()+a.substr(1);for(var i=0;i<r.length;i++)if("string"==typeof n[r[i]+a])return r[i]+a;return!1}var t={WebkitAnimation:"webkitAnimationEnd",OAnimation:"oAnimationEnd",msAnimation:"MSAnimationEnd",animation:"animationend"},n={WebkitTransition:"webkitTransitionEnd",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"};return{TRANSITION_END_EVENT:n[e("transition")],ANIMATION_END_EVENT:t[e("animation")]}}(),am.parser=function(){"use strict";return function(e){return"enter"===e?e="mouseenter":"leave"===e&&(e="mouseleave"),e}}(),am.viewport=function(){"use strict";function e(e){var t=0,n=0;do isNaN(e.offsetTop)||(t+=e.offsetTop),isNaN(e.offsetLeft)||(n+=e.offsetLeft);while(e=e.offsetParent);return{top:t,left:n}}function t(){var e=window.document.documentElement.clientHeight,t=window.innerHeight;return t>e?t:e}return{isInside:function(n,r){var a=window.pageYOffset,i=a+t(),o=n.offsetHeight,s=e(n).top,u=s+o;return r=r||.5,i>=s+o*r&&u>=a||"fixed"==(n.currentStyle?n.currentStyle:window.getComputedStyle(n,null)).position}}}(),am.styles=function(){"use strict";function e(e,n){return t[e]?void 0:"."+e+"{"+n+"}"}var t={};return{build:function(n,r){var a=e(n,r);if(!a)return n;var i=document.createElement("style");return i.type="text/css",i.innerHTML=a,t[n]=!0,document.getElementsByTagName("head")[0].appendChild(i),n}}}(),am.translate=function(e,t){"use strict";var n="am_";return function(r){var a,i="translate",o=i+r.axis+"("+r.move+")",s=r.scale,u=n;return s!==t&&(o+=" scale("+s.value+")"),a="-webkit-transform: "+o+";transform: "+o+";",r.opacity!==t&&(a+=" opacity: "+(r.opacity?"1":"0")+";"),u+=i+r.axis+"_"+r.move+"_"+r.opacity,s!==t&&(u+=("_scale"+s.value).replace(".","_")),u=u.replace(/-/g,"m"),e.build(u,a)}}(am.styles),am.transition=function(e){"use strict";return function(t,n,r){var a=t+" "+n+" "+r,i=a+", rotate, skew, scale, opacity "+a+";",o="_"+a.replace(/ /g,"_").replace(/\./g,"_"),s="-webkit-transition: -webkit-transform "+i+"transition: transform "+i;return e.build(o,s)}}(am.styles),am.transform=function(e,t){"use strict";function n(e){var t,n,r={};return e.forEach(function(a,i){if(n)return void(n=!1);switch(t=e[i+1],a){case"twist":return"left"===t?r.skewx=e[i+2]:"right"===t&&(r.skewx="-"+e[i+2]),void(n=!0);case"rotate":return"left"===t?r.rotatey="-"+e[i+2]:"right"===t&&(r.rotatey=e[i+2]),void(n=!0);case"move":var o=e[i+2];return"left"===t?r.translatex="-"+o:"right"===t?r.translatex=o:"bottom"===t?r.translatey=o:"top"===t&&(r.translatey="-"+o),void(n=!0);case"scale":if(r.scale={},"up"==t||"down"==t?(r.scale.direction=t,r.scale.power=e[i+2]):r.scale.power=t,0!=parseInt(r.scale.power)){var s=.01*parseFloat(r.scale.power);"up"==r.scale.direction&&(s=-s),r.scale.value=1+s}return;case"after":case"wait":return void(r.after=t);case"over":return void(r.over=t);default:return}}),r}var r="am_";return function(a){var i=n(a),o=i.skewx,s=i.skewy,u=i.rotatey,c=i.translatex,l=i.translatey,f=i.scale,m=i.over||"1.0s",v=i.after||"0s",d=i.easing||"ease-in-out",p=r,g="";o&&(g+="skewx("+o+") ",p+="skewx"+o),s&&(g+="skewy("+s+") ",p+="skewy"+s),c&&(g+="translatex("+c+")",p+="translatex"+c),l&&(g+="translatey("+l+")",p+="translatey"+l),u&&(g+="rotate("+u+") ",p+="rotate"+u),f&&(g+=" scale("+f.value+")",p+="scale"+f.value.toString().replace(".","_"));var w="-webkit-transform: "+g+" translateZ(0);transform: "+g+" translateZ(0);";return p=p.replace(/-/g,"m"),{target:e.build(p,w),reset:!0,transition:t(m,d,v)}}}(am.styles,am.transition),am.enter=function(e,t){"use strict";function n(e){var t,n={};return e.forEach(function(r,a){switch(t=e[a+1],r){case":enter":return n.enter=t,void(n.axis="top"===n.enter||"bottom"===n.enter?"y":"x");case"move":return void(n.move=t);case"after":case"wait":return void(n.after=t);case"over":return void(n.over=t);case"scale":if(n.scale={},"up"==t||"down"==t?(n.scale.direction=t,n.scale.power=e[a+2]):n.scale.power=t,0!=parseInt(n.scale.power)){var i=.01*parseFloat(n.scale.power);"up"==n.scale.direction&&(i=-i),n.scale.value=1+i}return;default:return}}),n}return function(r){var a=n(r),i=a.enter||"left",o="left"!==i&&"top"!==i?a.move:"-"+a.move,s=a.over||"0.7s",u=a.after||"0s",c=a.easing||"ease-in-out";return{initial:e({axis:a.axis,move:o,scale:a.scale,opacity:!1}),transition:t(s,c,u)}}}(am.translate,am.transition),am.frame=function(){var e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)};return function(t){e.call(window,t)}}(),am.build=function(e,t,n){"use strict";function r(e){getComputedStyle(e[0],null).display}function a(t,n,a,i,o){r(t),a&&t.addClass(a),t.hasClass(t.data("previous-target"))&&t.removeClass(t.data("previous-target")),t.addClass(i),n&&t.removeClass(n),t.one(e.TRANSITION_END_EVENT,function(){t.removeClass(i),t.data("previous-target",a),o&&o()})}return function(i,o,s){var u;return"enter"===o?function(e){u=t(s),i.addClass(u.initial),a(i,u.initial,null,u.transition,function(){e&&e()})}:"transform"===o?function(e){u=n(s),a(i,null,u.target,u.transition,function(){e&&e()})}:"animate"===o?function(t){r(i);var n=s+" animated";i.addClass(n).one(e.ANIMATION_END_EVENT,function(){i.removeClass(n),t&&t()})}:function(){alert("ERROR "+o)}}}(am.prefix,am.enter,am.transform),am.maestro=function(e,t){return{init:function(t){function n(t,n){var a=n.split(" "),i=a[0],o=e(a[1]);[].forEach.call(document.querySelectorAll(i),function(e){e.addEventListener(o,function(){r.state(t)})})}var r=this,a=t.triggers;r.events=t.events,r.element=t.element,r.deferFn=t.timeoutFn,r.jobs=[],r.unregisters=[],r.currentState,r.running;for(var i in a){var o=a[i];o&&n(i,o)}},state:function(e){function n(e){s.jobs.push(e),r()}function r(){if(!s.running){var e=s.jobs[0];e&&(s.running=!0,e.run(function(){e.finish(),s.jobs.splice(0,1),s.running=!1,r()}))}}function a(e){if(e){var t=[];return e.forEach(function(e){t.push(o(e))}),t}}function i(e){e=window[e],"function"==typeof e&&e.apply(null,s)}function o(e){function r(){if(f&&i(f),!e.param)return void a();var t=e.param.split(" "),r=t[0];if(t){var u=r.slice(1,r.length);":animate"===r?(e.currentStep+=1,e.currentStep>=t.length?console.warn("try to relaunch animation that is not finished"):n({run:am.build(s.element,u,t[e.currentStep]),finish:c})):n({run:am.build(s.element,u,t),finish:o})}}function a(){l&&(v!==u&&s.element.off(v,r),s.state(l))}function o(){a(),m&&i(m)}function c(){e.currentStep<e.param.split(" ").length-1?t(r):e.currentStep=0,o()}var l=e.goto,f=e.before,m=e.after,v=e.on;return v===u?t(r):s.element.on(v,r),function(){s.element.off(v,r)}}var s=this,u="active",c=s.currentState===e;if(s.currentState&&s.unregisters&&!c)for(var l=0;l<s.unregisters.length;l++)s.unregisters[l]();c?a(s.events[e]):(s.currentState=e,s.unregisters=a(s.events[e]))}}}(am.parser,am.frame),angular.module("aniMachine",[]).directive("amElement",["$window",function(e){return{restrict:"A",scope:{enter:"@"},link:function(t,n){var r=t.events,a=t.triggers,i=Object.create(am.maestro);i.init({triggers:a,events:r,element:n}),(r.enter||r.leave)&&(am.viewport.isInside(n[0])&&(r["default"]||i.state("enter")),t.$watch(function(){return am.viewport.isInside(n[0])},function(e,t){e!==t&&i.state(e?"enter":"leave")},!0),angular.element(e).bind("resize",function(){t.$apply()}).bind("scroll",function(){t.$apply()})),i.state("default")},controller:["$scope","$element",function(e){e.events={},e.triggers={},this.setEvents=function(t,n,r){t=t||"default",e.events[t]=r,e.triggers[t]=n}}]}}]).directive("amState",function(){return{restrict:"E",scope:{value:"@",trigger:"@"},require:"^amElement",link:function(e,t,n,r){r.setEvents(e.value,e.trigger,e.events)},controller:["$scope",function(e){e.events=[],this.addEvent=function(t){e.events.push(t)}}]}}).directive("amEvent",function(){return{restrict:"E",scope:{on:"@",before:"@",after:"@","do":"@","goto":"@"},require:"^amState",link:function(e,t,n,r){r.addEvent({on:am.parser(e.on),param:e.do,currentStep:0,before:e.before?e.before.replace("()",""):"",after:e.after?e.after.replace("()",""):"","goto":e.goto})}}});