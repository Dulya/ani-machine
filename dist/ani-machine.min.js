/**
 * ani-machine - Declarative animation and machine state
 * @version v0.1.4
 * @link https://github.com/jfroffice/ani-machine
 * @license MIT
 */
var am={};am.prefix=function(){"use strict";function t(t){var e=document.body||document.documentElement,n=e.style,r=["Moz","Webkit","Khtml","O","ms"],i=t;if("string"==typeof n[i])return t;i=i.charAt(0).toUpperCase()+i.substr(1);for(var a=0;a<r.length;a++)if("string"==typeof n[r[a]+i])return r[a]+i;return!1}var e={WebkitAnimation:"webkitAnimationEnd",OAnimation:"oAnimationEnd",msAnimation:"MSAnimationEnd",animation:"animationend"},n={WebkitTransition:"webkitTransitionEnd",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"};return{TRANSITION_END_EVENT:n[t("transition")],ANIMATION_END_EVENT:e[t("animation")]}}(),am.parser=function(){"use strict";return function(t){return"enter"===t?t="mouseenter":"leave"===t&&(t="mouseleave"),t}}(),am.viewport=function(){"use strict";function t(t){var e=0,n=0;do isNaN(t.offsetTop)||(e+=t.offsetTop),isNaN(t.offsetLeft)||(n+=t.offsetLeft);while(t=t.offsetParent);return{top:e,left:n}}function e(){var t=window.document.documentElement.clientHeight,e=window.innerHeight;return e>t?e:t}return{isInside:function(n,r){var i=window.pageYOffset,a=i+e(),o=n.offsetHeight,s=t(n).top,u=s+o;return r=r||.5,a>=s+o*r&&u>=i||"fixed"==(n.currentStyle?n.currentStyle:window.getComputedStyle(n,null)).position}}}(),am.styles=function(){"use strict";function t(t,n){return e[t]?void 0:(e[t]=!0,"."+t+"{"+n+"}")}var e={};return function(e,n){var r=t(e,n);if(!r)return e;var i=document.createElement("style");return i.type="text/css",i.innerHTML=r,document.getElementsByTagName("head")[0].appendChild(i),e}}(),am.translate=function(t,e){"use strict";return function(n){var r,i,a="translate",o=a+n.axis+"("+n.move+")",s=n.scale;s!==e&&(o+=" scale("+s.value+")"),r="-webkit-transform: "+o+";transform: "+o+";",n.opacity!==e&&(r+=" opacity: "+(n.opacity?"1":"0")+";");var i=a+n.axis+"_"+n.move+"_"+n.opacity;return s!==e&&(i+=("_scale"+s.value).replace(".","_")),i=i.replace(/-/g,"m"),t(i,r)}}(am.styles),am.transition=function(t){"use strict";return function(e,n,r){var i=e+" "+n+" "+r,a=i+", skew, scale, opacity "+i+";",o="_"+i.replace(/ /g,"_").replace(/\./g,"_"),s="-webkit-transition: -webkit-transform "+a+"transition: transform "+a;return t(o,s)}}(am.styles),am.transform=function(t,e){"use strict";function n(t){var e,n,r={};return t.forEach(function(i,a){if(n)return void(n=!1);switch(e=t[a+1],i){case"twist":return"left"===e?r.skewx=t[a+2]:"right"===e&&(r.skewx="-"+t[a+2]),void(n=!0);case"move":return"left"===e?r.translatex="-"+t[a+2]:"right"===e?r.translatex=t[a+2]:"bottom"===e?r.translatey=t[a+2]:"top"===e&&(r.translatey="-"+t[a+2]),void(n=!0);default:return}}),r}return function(r){var i=n(r),a=i.skewx,o=i.translatex,s=i.translatey,u=i.over||"1.0s",c=i.after||"0s",f=i.easing||"ease-in-out",l="",m="";a&&(m="skewx("+a+") ",l="skewx"+a),o&&(m+="translatex("+o+")",l+="translatex"+o),s&&(m+="translatey("+s+")",l+="translatey"+s);var v="-webkit-transform: "+m+"; transform: "+m;return l=l.replace(/-/g,"m"),{target:t(l,v),transition:e(u,f,c)}}}(am.styles,am.transition),am.enter=function(t,e){"use strict";function n(t){var e,n=t,r={};return n.forEach(function(t,i){switch(e=n[i+1],t){case":enter":return void(r.enter=e);case"after":case"wait":return void(r.after=e);case"move":return void(r.move=e);case"over":return void(r.over=e);case"scale":return r.scale={},"up"==e||"down"==e?(r.scale.direction=e,void(r.scale.power=n[i+2])):void(r.scale.power=e);default:return}}),r}return function(r){var i=n(r),a=i.enter||"left",o="left"!==a&&"top"!==a?i.move:"-"+i.move,s=i.over||"0.7s",u=i.after||"0s",c=i.easing||"ease-in-out",f=i.scale,l="x";if(!a||"top"!==a&&"bottom"!==a||(l="y"),f&&0!=parseInt(f.power)){var m=.01*parseFloat(f.power);"up"==f.direction&&(m=-m),f.value=1+m}return{initial:t({axis:l,move:o,scale:f,opacity:!1}),transition:e(s,c,u)}}}(am.translate,am.transition),am.frame=function(){var t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)};return function(e){t.call(window,e)}}(),am.build=function(t,e,n){"use strict";function r(t){getComputedStyle(t[0],null).display}function i(e,n,i,a,o){r(e),i&&e.addClass(i),e.addClass(a),n&&e.removeClass(n),e.one(t.TRANSITION_END_EVENT,function(){e.removeClass(a),o&&o()})}return function(a,o,s){var u;return"enter"===o?function(t){u=e(s),a.addClass(u.initial),i(a,u.initial,null,u.transition,function(){t&&t()})}:"transform"===o?function(t){u=n(s),i(a,null,u.target,u.transition,function(){t&&t()})}:function(e){r(a);var n=s+" animated";a.addClass(n).one(t.ANIMATION_END_EVENT,function(){a.removeClass(n),e&&e()})}}}(am.prefix,am.enter,am.transform),am.maestro=function(t,e){return{init:function(e){function n(e,n){var i=n.split(" "),a=i[0],o=t(i[1]);[].forEach.call(document.querySelectorAll(a),function(t){t.addEventListener(o,function(){r.state(e)})})}var r=this,i=e.triggers;r.events=e.events,r.element=e.element,r.deferFn=e.timeoutFn,r.jobs=[],r.unregisters=[],r.currentState,r.running;for(var a in i){var o=i[a];o&&n(a,o)}},state:function(t){function n(t){s.jobs.push(t),r()}function r(){if(!s.running){var t=s.jobs[0];t&&(s.running=!0,t.run(function(){t.finish(),s.jobs.splice(0,1),s.running=!1,r()}))}}function i(t){if(t){var e=[];return t.forEach(function(t){e.push(o(t))}),e}}function a(t){t=window[t],"function"==typeof t&&t.apply(null,s)}function o(t){function r(){if(l&&a(l),!t.param)return void i();var e=t.param.split(" "),r=e[0];e&&0===r.indexOf(":")?n({run:am.build(s.element,r.slice(1,r.length),e),finish:o}):(t.currentStep+=1,t.currentStep>=e.length?console.warn("try to relaunch animation that is not finished"):n({run:am.build(s.element,t.type,e[t.currentStep]),finish:c}))}function i(){f&&(v!==u&&s.element.off(v,r),s.state(f))}function o(){i(),m&&a(m)}function c(){t.currentStep<t.param.split(" ").length-1?e(r):t.currentStep=-1,o()}var f=t.goto,l=t.before?t.before.replace("()",""):"",m=t.after?t.after.replace("()",""):"",v=t.on;return v===u?e(r):s.element.on(v,r),function(){s.element.off(v,r)}}var s=this,u="active",c=s.currentState===t;if(s.currentState&&s.unregisters&&!c)for(var f=0;f<s.unregisters.length;f++)s.unregisters[f]();c?i(s.events[t]):(s.currentState=t,s.unregisters=i(s.events[t]))}}}(am.parser,am.frame),angular.module("aniMachine",[]).directive("amElement",["$window",function(t){return{restrict:"A",scope:{enter:"@"},link:function(e,n){var r=e.events,i=e.triggers,a=Object.create(am.maestro);a.init({triggers:i,events:r,element:n}),(r.enter||r.leave)&&(am.viewport.isInside(n[0])&&(r["default"]||a.state("enter")),e.$watch(function(){return am.viewport.isInside(n[0])},function(t,e){t!==e&&a.state(t?"enter":"leave")},!0),angular.element(t).bind("resize",function(){e.$apply()}).bind("scroll",function(){e.$apply()})),a.state("default")},controller:["$scope","$element",function(t){t.events={},t.triggers={},this.setEvents=function(e,n,r){e=e||"default",t.events[e]=r,t.triggers[e]=n}}]}}]).directive("amState",function(){return{restrict:"E",scope:{value:"@",trigger:"@"},require:"^amElement",link:function(t,e,n,r){r.setEvents(t.value,t.trigger,t.events)},controller:["$scope",function(t){t.events=[],this.addEvent=function(e){t.events.push(e)}}]}}).directive("amEvent",function(){return{restrict:"E",scope:{on:"@",before:"@",after:"@",animate:"@","goto":"@"},require:"^amState",link:function(t,e,n,r){var i,a,o=am.parser(t.on);t.animate&&(i="animate",a=t.animate),r.addEvent({on:o,type:i,param:a,currentStep:-1,before:t.before,after:t.after,"goto":t.goto})}}});