/**
 * ani-machine - Declarative animation and machine state
 * @version v0.1.4
 * @link https://github.com/jfroffice/ani-machine
 * @license MIT
 */
var prefix=function(){"use strict";function e(e){var t=document.body||document.documentElement,n=t.style,r=["Moz","Webkit","Khtml","O","ms"],i=e;if("string"==typeof n[i])return e;i=i.charAt(0).toUpperCase()+i.substr(1);for(var a=0;a<r.length;a++)if("string"==typeof n[r[a]+i])return r[a]+i;return!1}var t={WebkitAnimation:"webkitAnimationEnd",OAnimation:"oAnimationEnd",msAnimation:"MSAnimationEnd",animation:"animationend"},n={WebkitTransition:"webkitTransitionEnd",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"};return{TRANSITION_END_EVENT:n[e("transition")],ANIMATION_END_EVENT:t[e("animation")]}}(),tt=function(){"use strict";return{parseOn:function(e){return"enter"===e?e="mouseenter":"leave"===e&&(e="mouseleave"),e}}}(),am=am||{};am.viewport=function(){"use strict";function e(e){var t=0,n=0;do isNaN(e.offsetTop)||(t+=e.offsetTop),isNaN(e.offsetLeft)||(n+=e.offsetLeft);while(e=e.offsetParent);return{top:t,left:n}}function t(){var e=window.document.documentElement.clientHeight,t=window.innerHeight;return t>e?t:e}return{isInside:function(n,r){var i=window.pageYOffset,a=i+t(),o=n.offsetHeight,s=e(n).top,u=s+o;return r=r||.5,a>=s+o*r&&u>=i||"fixed"==(n.currentStyle?n.currentStyle:window.getComputedStyle(n,null)).position}}}();var styles=function(){"use strict";function e(e,t){return n[e]?void 0:(n[e]=!0,"."+e+"{"+t+"}")}function t(t,n){var r=e(t,n);if(!r)return t;var i=document.createElement("style");return i.type="text/css",i.innerHTML=r,document.getElementsByTagName("head")[0].appendChild(i),t}var n={};return{add:t}}(),translate=function(e){"use strict";function t(t){var n,r,i="translate",a=i+t.axis+"("+t.move+")";t.scale!==e&&(a+=" scale("+t.scale.value+")"),n="-webkit-transform: "+a+";transform: "+a+";",t.opacity!==e&&(n+=" opacity: "+(t.opacity?"1":"0")+";");var r=(i+"_"+t.axis+"_"+t.move+"_"+t.opacity).replace(/-/g,"m");return console.log(n),styles.add(r,n)}return{genCSS:t}}(),transition=function(){"use strict";function e(e,t,n){var r=e+" "+t+" "+n,i=r+", scale, opacity "+r+";",a="_"+r.replace(/ /g,"_").replace(/\./g,"_"),o="-webkit-transition: -webkit-transform "+i+"transition: transform "+i;return console.log(o),styles.add(a,o)}return{genCSS:e}}(),enter=function(){"use strict";function e(e){var t,n=e.split(/[, ]+/),r={};return n.forEach(function(e,i){switch(t=n[i+1],e){case"enter":return void(r.enter=t);case"after":case"wait":return void(r.after=t);case"move":return void(r.move=t);case"over":return void(r.over=t);case"scale":return r.scale={},"up"==t||"down"==t?(r.scale.direction=t,void(r.scale.power=n[i+2])):void(r.scale.power=t);default:return}}),r}function t(t){var n=e("enter "+t),r=n.over||"0.7s",i=n.enter||"left",a="left"!==i&&"top"!==i?n.move:"-"+n.move,o=n.after||"0s",s=n.easing||"ease-in-out",u=n.scale,c="x";if(!i||"top"!==i&&"bottom"!==i||(c="y"),u&&0!=parseInt(u.power)){var f=.01*parseFloat(u.power);"up"==u.direction&&(f=-f),u.value=1+f}return{initial:translate.genCSS({axis:c,move:a,scale:u,opacity:!1}),transition:transition.genCSS(r,s,o)}}return{genCSS:t}}();am.frame=function(){var e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)};return function(t){e.call(window,t)}}(),am.build=function(){"use strict";function e(e){getComputedStyle(e[0],null).display}function t(t,n,r,i,a){e(t),r&&(t.addClass(r),console.log(r)),t.addClass(i),n&&t.removeClass(n),t.one(prefix.TRANSITION_END_EVENT,function(){t.removeClass(i),a&&a()})}return function(n,r,i){var a;return"enter"===r?function(e){a=enter.genCSS(i),n.addClass(a.initial),t(n,a.initial,null,a.transition,function(){e&&e()})}:function(t){e(n);var r=i+" animated";n.addClass(r).one(prefix.ANIMATION_END_EVENT,function(){n.removeClass(r),t&&t()})}}}(),am.maestro={init:function(e){function t(e,t){var r=t.split(" "),i=r[0],a=tt.parseOn(r[1]);[].forEach.call(document.querySelectorAll(i),function(t){t.addEventListener(a,function(){n.changeState(e)})})}var n=this,r=e.triggers;n.events=e.events,n.element=e.element,n.deferFn=e.timeoutFn,n.jobs=[],n.unregisters=[],n.currentState,n.running;for(var i in r){var a=r[i];a&&t(i,a)}},changeState:function(e){function t(e){o.jobs.push(e),n()}function n(){if(!o.running){var e=o.jobs[0];e&&(o.running=!0,e.run(function(){e.finish(),o.jobs.splice(0,1),o.running=!1,n()}))}}function r(e){if(e){var t=[];return e.forEach(function(e){t.push(a(e))}),t}}function i(e){e=window[e],"function"==typeof e&&e.apply(null,o)}function a(e){function n(){if(f&&i(f),!e.param)return void r();var n=e.param.split(" ");n&&":enter"===n[0]?t({run:am.build(o.element,"enter",n.slice(1,n.length)),finish:a}):(e.currentStep+=1,e.currentStep>=n.length?console.warn("try to relaunch animation that is not finished"):t({run:am.build(o.element,e.type,n[e.currentStep]),finish:u}))}function r(){c&&(m!==s&&o.element.off(m,n),o.changeState(c))}function a(){r(),l&&i(l)}function u(){e.currentStep<e.param.split(" ").length-1?am.frame(n):e.currentStep=-1,a()}var c=e.goto,f=e.before?e.before.replace("()",""):"",l=e.after?e.after.replace("()",""):"",m=e.on;return m===s?am.frame(n):o.element.on(m,n),function(){o.element.off(m,n)}}var o=this,s="active",u=o.currentState===e;if(o.currentState&&o.unregisters&&!u)for(var c=0;c<o.unregisters.length;c++)o.unregisters[c]();u?r(o.events[e]):(o.currentState=e,o.unregisters=r(o.events[e]))}},angular.module("aniMachine",[]).directive("amElement",["$timeout","$window",function(e,t){return{restrict:"A",scope:{enter:"@"},link:function(n,r){var i=n.events,a=n.triggers,o=Object.create(am.maestro);o.init({triggers:a,events:i,element:r,timeoutFn:e}),(i.enter||i.leave)&&(am.viewport.isInside(r[0])&&(i["default"]||o.changeState("enter")),n.$watch(function(){return am.viewport.isInside(r[0])},function(e,t){e!==t&&o.changeState(e?"enter":"leave")},!0),angular.element(t).bind("resize",function(){n.$apply()}).bind("scroll",function(){n.$apply()})),o.changeState("default")},controller:["$scope","$element",function(e){e.events={},e.triggers={},this.setEvents=function(t,n,r){t=t||"default",e.events[t]=r,e.triggers[t]=n}}]}}]).directive("amState",function(){return{restrict:"E",scope:{value:"@",trigger:"@"},require:"^amElement",link:function(e,t,n,r){r.setEvents(e.value,e.trigger,e.events)},controller:["$scope",function(e){e.events=[],this.addEvent=function(t){e.events.push(t)}}]}}).directive("amEvent",function(){return{restrict:"E",scope:{on:"@",before:"@",after:"@",animate:"@","goto":"@"},require:"^amState",link:function(e,t,n,r){var i,a,o=tt.parseOn(e.on);e.animate&&(i="animate",a=e.animate),r.addEvent({on:o,type:i,param:a,currentStep:-1,before:e.before,after:e.after,"goto":e.goto})}}});