/**
 * ani-machine - Declarative animation and machine state
 * @version v0.1.4
 * @link https://github.com/jfroffice/ani-machine
 * @license MIT
 */
var am={};am.prefix=function(){"use strict";function e(e){var t=document.body||document.documentElement,n=t.style,r=["Moz","Webkit","Khtml","O","ms"],i=e;if("string"==typeof n[i])return e;i=i.charAt(0).toUpperCase()+i.substr(1);for(var a=0;a<r.length;a++)if("string"==typeof n[r[a]+i])return r[a]+i;return!1}var t={WebkitAnimation:"webkitAnimationEnd",OAnimation:"oAnimationEnd",msAnimation:"MSAnimationEnd",animation:"animationend"},n={WebkitTransition:"webkitTransitionEnd",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"};return{TRANSITION_END_EVENT:n[e("transition")],ANIMATION_END_EVENT:t[e("animation")]}}(),am.parser=function(){"use strict";return function(e){return"enter"===e?e="mouseenter":"leave"===e&&(e="mouseleave"),e}}(),am.viewport=function(){"use strict";function e(e){var t=0,n=0;do isNaN(e.offsetTop)||(t+=e.offsetTop),isNaN(e.offsetLeft)||(n+=e.offsetLeft);while(e=e.offsetParent);return{top:t,left:n}}function t(){var e=window.document.documentElement.clientHeight,t=window.innerHeight;return t>e?t:e}return{isInside:function(n,r){var i=window.pageYOffset,a=i+t(),o=n.offsetHeight,s=e(n).top,u=s+o;return r=r||.5,a>=s+o*r&&u>=i||"fixed"==(n.currentStyle?n.currentStyle:window.getComputedStyle(n,null)).position}}}(),am.styles=function(){"use strict";function e(e,n){return t[e]?void 0:(t[e]=!0,"."+e+"{"+n+"}")}var t={};return function(t,n){var r=e(t,n);if(!r)return t;var i=document.createElement("style");return i.type="text/css",i.innerHTML=r,document.getElementsByTagName("head")[0].appendChild(i),t}}(),am.translate=function(e,t){"use strict";return function(n){var r,i,a="translate",o=a+n.axis+"("+n.move+")",s=n.scale;s!==t&&(o+=" scale("+s.value+")"),r="-webkit-transform: "+o+";transform: "+o+";",n.opacity!==t&&(r+=" opacity: "+(n.opacity?"1":"0")+";");var i=a+n.axis+"_"+n.move+"_"+n.opacity;return s!==t&&(i+=("_scale"+s.value).replace(".","_")),i=i.replace(/-/g,"m"),e(i,r)}}(am.styles),am.transition=function(e){"use strict";return function(t,n,r){var i=t+" "+n+" "+r,a=i+", skew, scale, opacity "+i+";",o="_"+i.replace(/ /g,"_").replace(/\./g,"_"),s="-webkit-transition: -webkit-transform "+a+"transition: transform "+a;return e(o,s)}}(am.styles),am.enter=function(e,t){"use strict";function n(e){var t,n=e,r={};return n.forEach(function(e,i){switch(t=n[i+1],e){case"enter":return void(r.enter=t);case"after":case"wait":return void(r.after=t);case"move":return void(r.move=t);case"over":return void(r.over=t);case"scale":return r.scale={},"up"==t||"down"==t?(r.scale.direction=t,void(r.scale.power=n[i+2])):void(r.scale.power=t);default:return}}),r}return function(r){var i=n(r),a=i.enter||"left",o="left"!==a&&"top"!==a?i.move:"-"+i.move,s=i.over||"0.7s",u=i.after||"0s",c=i.easing||"ease-in-out",f=i.scale,l="x";if(!a||"top"!==a&&"bottom"!==a||(l="y"),f&&0!=parseInt(f.power)){var m=.01*parseFloat(f.power);"up"==f.direction&&(m=-m),f.value=1+m}return{initial:e({axis:l,move:o,scale:f,opacity:!1}),transition:t(s,c,u)}}}(am.translate,am.transition),am.frame=function(){var e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)};return function(t){e.call(window,t)}}(),am.build=function(e,t,n){"use strict";function r(e){getComputedStyle(e[0],null).display}function i(t,n,i,a,o){r(t),i&&t.addClass(i),t.addClass(a),n&&t.removeClass(n),t.one(e.TRANSITION_END_EVENT,function(){t.removeClass(a),o&&o()})}return function(a,o,s){var u;return"enter"===o?function(e){u=t(s),a.addClass(u.initial),i(a,u.initial,null,u.transition,function(){e&&e()})}:"transform"===o?function(e){u=n(s),i(a,null,u.target,u.transition,function(){e&&e()})}:function(t){r(a);var n=s+" animated";a.addClass(n).one(e.ANIMATION_END_EVENT,function(){a.removeClass(n),t&&t()})}}}(am.prefix,am.enter,am.transform),am.maestro=function(e,t){return{init:function(t){function n(t,n){var i=n.split(" "),a=i[0],o=e(i[1]);[].forEach.call(document.querySelectorAll(a),function(e){e.addEventListener(o,function(){r.state(t)})})}var r=this,i=t.triggers;r.events=t.events,r.element=t.element,r.deferFn=t.timeoutFn,r.jobs=[],r.unregisters=[],r.currentState,r.running;for(var a in i){var o=i[a];o&&n(a,o)}},state:function(e){function n(e){s.jobs.push(e),r()}function r(){if(!s.running){var e=s.jobs[0];e&&(s.running=!0,e.run(function(){e.finish(),s.jobs.splice(0,1),s.running=!1,r()}))}}function i(e){if(e){var t=[];return e.forEach(function(e){t.push(o(e))}),t}}function a(e){e=window[e],"function"==typeof e&&e.apply(null,s)}function o(e){function r(t){var r=t.split(" "),i=r[0];r?n({run:am.build(s.element,i,r),finish:c}):(e.currentStep+=1,e.currentStep>=r.length?console.warn("try to relaunch animation that is not finished"):n({run:am.build(s.element,e.type,r[e.currentStep]),finish:f}))}function i(){if(m&&a(m),!e.param)return void o();var t=e.param.split(":");t.forEach(function(e){e.length&&r(e)})}function o(){l&&(d!==u&&s.element.off(d,i),s.state(l))}function c(){o(),v&&a(v)}function f(){e.currentStep<e.param.split(" ").length-1?t(i):e.currentStep=-1,c()}var l=e.goto,m=e.before?e.before.replace("()",""):"",v=e.after?e.after.replace("()",""):"",d=e.on;return d===u?t(i):s.element.on(d,i),function(){s.element.off(d,i)}}var s=this,u="active",c=s.currentState===e;if(s.currentState&&s.unregisters&&!c)for(var f=0;f<s.unregisters.length;f++)s.unregisters[f]();c?i(s.events[e]):(s.currentState=e,s.unregisters=i(s.events[e]))}}}(am.parser,am.frame),angular.module("aniMachine",[]).directive("amElement",["$window",function(e){return{restrict:"A",scope:{enter:"@"},link:function(t,n){var r=t.events,i=t.triggers,a=Object.create(am.maestro);a.init({triggers:i,events:r,element:n}),(r.enter||r.leave)&&(am.viewport.isInside(n[0])&&(r["default"]||a.state("enter")),t.$watch(function(){return am.viewport.isInside(n[0])},function(e,t){e!==t&&a.state(e?"enter":"leave")},!0),angular.element(e).bind("resize",function(){t.$apply()}).bind("scroll",function(){t.$apply()})),a.state("default")},controller:["$scope","$element",function(e){e.events={},e.triggers={},this.setEvents=function(t,n,r){t=t||"default",e.events[t]=r,e.triggers[t]=n}}]}}]).directive("amState",function(){return{restrict:"E",scope:{value:"@",trigger:"@"},require:"^amElement",link:function(e,t,n,r){r.setEvents(e.value,e.trigger,e.events)},controller:["$scope",function(e){e.events=[],this.addEvent=function(t){e.events.push(t)}}]}}).directive("amEvent",function(){return{restrict:"E",scope:{on:"@",before:"@",after:"@",animate:"@","goto":"@"},require:"^amState",link:function(e,t,n,r){var i,a,o=am.parser(e.on);e.animate&&(i="animate",a=e.animate),r.addEvent({on:o,type:i,param:a,currentStep:-1,before:e.before,after:e.after,"goto":e.goto})}}});